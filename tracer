#!/bin/bash
# Tracer - Real-time network inspector for Android
# Works with the io.tracer Android SDK

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
WEB_DIR="$SCRIPT_DIR/web"

echo "ğŸ” Checking for existing Tracer processes..."
pkill -f "node.*web/index.js" 2>/dev/null
if [ $? -eq 0 ]; then
    echo "âœ“ Stopped existing Tracer server"
    sleep 1
else
    echo "âœ“ No existing server found"
fi

cd "$WEB_DIR"

# Setup port forwarding for connected devices
echo "ğŸ”— Setting up ADB port forwarding..."
adb reverse tcp:3000 tcp:3000 2>/dev/null && echo "âœ“ Port forwarding enabled" || echo "âš ï¸  No device connected (run 'adb reverse tcp:3000 tcp:3000' manually after connecting)"

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "  ğŸ“± Tracer - Android Network Inspector"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "  Open: http://localhost:3000"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

npm start
